-- GISTINDEXES
-- test01CreateTable.sql
-- start_ignore
DROP TABLE IF EXISTS pre_GistTable1;
NOTICE:  table "pre_gisttable1" does not exist, skipping
DROP TABLE IF EXISTS GistTable1;
NOTICE:  table "gisttable1" does not exist, skipping
-- end_ignore
CREATE TABLE pre_GistTable1 (
 id INTEGER,
 owner VARCHAR,
 description VARCHAR,
 property BOX, -- Assumes that all properties are rectangles whose sides are 
                -- aligned North/South, East/West.
 poli POLYGON,
 bullseye CIRCLE,
 v VARCHAR,
 t TEXT,
 f FLOAT, 
 p POINT,
 c CIRCLE,
 filler VARCHAR DEFAULT 'This is here just to take up space so that we use more pages of data and sequential scans take a lot more time.  Stones tinheads and mixers coming; we did it all on our own; this summer I hear the crunching; 11 dead in Ohio. Got right down to it; we were cutting us down; could have had fun but, no; left them face down dead on the ground.  How can you listen when you know?'
 )
 DISTRIBUTED BY (id)
 PARTITION BY RANGE (id)
  (
  PARTITION p_one START('1') INCLUSIVE END ('10') EXCLUSIVE,
  DEFAULT PARTITION de_fault
  )
;
NOTICE:  CREATE TABLE will create partition "pre_gisttable1_1_prt_de_fault" for table "pre_gisttable1"
NOTICE:  CREATE TABLE will create partition "pre_gisttable1_1_prt_p_one" for table "pre_gisttable1"
CREATE TABLE GistTable1 AS SELECT * FROM pre_GistTable1;
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column(s) named 'id' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
\COPY GistTable1 FROM 'bugbuster/data/PropertyInfo.txt' CSV;
-- test03IndexScan.sql
CREATE INDEX propertyBoxIndex ON GistTable1 USING Gist (property);
-- INSERT some more data.
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye) 
 VALUES (66, 'Miller', 'Lubbock or leave it', '((3, 1300), (33, 1330))',
   '( (66,660), (67, 650), (68, 660) )', '( (66, 66), 66)' );
SET enable_seqscan = FALSE;
-- We should be able to search the column that uses a geometric data type, 
-- and of course we should find the right rows.  We should be able to search 
-- using different "formats" (e.g. spacing) of the data, and in some cases 
-- even different "order" of the data (if the data is converted to a 
-- canonical form, as it is for the BOX data type and perhaps some other 
-- data types), as long as data in all of those formats should be converted 
-- to the same internal representation.
SELECT owner, property FROM GistTable1 
 WHERE property ~= '((7052,250),(6050,20))';
  owner  |       property       
---------+----------------------
  Patty  | (7052,250),(6050,20)
 Hypatia | (7052,250),(6050,20)
(2 rows)

SELECT owner, property FROM GistTable1 
 WHERE property ~= ' ( ( 7052, 250 ) , (6050, 20) )';
  owner  |       property       
---------+----------------------
 Hypatia | (7052,250),(6050,20)
  Patty  | (7052,250),(6050,20)
(2 rows)

SELECT owner, property FROM GistTable1
 WHERE property ~= '( (6050, 20), (7052, 250) )';
  owner  |       property       
---------+----------------------
 Hypatia | (7052,250),(6050,20)
  Patty  | (7052,250),(6050,20)
(2 rows)

-- start_ignore
EXPLAIN 
SELECT owner, property FROM GistTable1
 WHERE property ~= '( (6050, 20), (7052, 250) )';
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..200.27 rows=1 width=64)
   ->  Index Scan using propertyboxindex on gisttable1  (cost=0.00..200.27 rows=1 width=64)
         Index Cond: property ~= '(7052,250),(6050,20)'::box
 Settings:  enable_seqscan=off
(4 rows)

-- end_ignore
SELECT id, property FROM GistTable1 
 WHERE property IS NULL 
 ORDER BY id;
 id | property 
----+----------
  8 | 
(1 row)

-- Alter the table and see if we get the same results.
ALTER TABLE GistTable1 CLUSTER ON propertyBoxIndex;
SELECT owner, property FROM GistTable1 
 WHERE property ~= '((7052,250),(6050,20))';
  owner  |       property       
---------+----------------------
 Hypatia | (7052,250),(6050,20)
  Patty  | (7052,250),(6050,20)
(2 rows)

SELECT owner, property FROM GistTable1 
 WHERE property ~= ' ( ( 7052, 250 ) , (6050, 20) )';
  owner  |       property       
---------+----------------------
 Hypatia | (7052,250),(6050,20)
  Patty  | (7052,250),(6050,20)
(2 rows)

SELECT owner, property FROM GistTable1
 WHERE property ~= '( (6050, 20), (7052, 250) )';
  owner  |       property       
---------+----------------------
 Hypatia | (7052,250),(6050,20)
  Patty  | (7052,250),(6050,20)
(2 rows)

-- start_ignore
EXPLAIN
SELECT owner, property FROM GistTable1
 WHERE property ~= '( (6050, 20), (7052, 250) )';
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..200.27 rows=1 width=64)
   ->  Index Scan using propertyboxindex on gisttable1  (cost=0.00..200.27 rows=1 width=64)
         Index Cond: property ~= '(7052,250),(6050,20)'::box
 Settings:  enable_seqscan=off
(4 rows)

-- end_ignore
SELECT id, property FROM GistTable1 
 WHERE property IS NULL 
 ORDER BY id;
 id | property 
----+----------
  8 | 
(1 row)

--test04insert.sql
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye) VALUES (76, 'James McMurtry', 'Levelland', '((1500, 1500), (1700, 1900))', '( (76, 77), (76, 75), (75, 77) )', '( (76, 76), 76)' );
-- test05Select.sql
SET enable_seqscan = FALSE;
SELECT id, owner, description, property, poli, bullseye FROM GistTable1 WHERE property IS NOT NULL ORDER BY id;
 id |              owner              |               description               |                  property                   |             poli             |   bullseye   
----+---------------------------------+-----------------------------------------+---------------------------------------------+------------------------------+--------------
  1 | Snidely Whiplash                |  an empire dreamt of but as yet unbuilt | (1,1),(0,0)                                 | ((0,0),(1,1),(2,2),(3,3))    | <(0,0),0>
  2 | Theodore Turner                 |  a ranch and reserve                    | (2100,2100),(2000,2000)                     | ((1,1),(2,1),(1,2))          | <(2,2),2>
  3 | Theodore Roosevelt              |  overlooks Yellowstone River            | (1801,2201),(1800,2200)                     | ((3,3),(3,4),(4,3))          | <(3,3),3>
  4 | Donald Duck                     |  overlooks Colorado River               | (1001,1001),(1000,1000)                     | ((4,4),(4,5),(5,4),(5,5))    | <(4,4),4>
  5 | Roger Rabbit                    |  Toon Town, unit 127                    | (-999999,-100000),(-1000000,-999999)        | ((5,-1),(5,-2),(5,-5))       | <(5,5),5>
  6 | James T. Kirk                   |  Utopia Planetia                        | (123456790,123456790),(123456789,123456789) | ((6,7),(6,5),(5,7))          | <(6,6),6>
  7 | Albus Dumbledore                |  Hogwarts                               | (-11999990,-11999990),(-12000000,-12000000) | ((7,7),(7,8),(6,7))          | <(7,7),7>
  9 | Hyquotia P. Cucumber            | Radical Vegan Farms                     | (42,25),(40,20)                             | ((9,9),(9,8),(8,10))         | <(9,9),9>
 10 | Junipero Serra                  | California                              | (200,1000),(0,0)                            | ((10,10),(10,9),(8,11))      | <(10,10),10>
 18 | K. Serra                        | California                              | (200,1000),(0,0)                            | ((18,18),(18,19),(17,19))    | <(18,18),18>
 19 | Kay Serra                       | California                              | (200,1000),(0,0)                            | ((19,19),(19,18),(20,19))    | <(19,19),19>
 38 | Que Sera                        | California                              | (200,1000),(0,0)                            | ((38,38),(38,39),(37,38))    | <(38,38),38>
 59 | Hypatia                         | Greece                                  | (7052,250),(6050,20)                        | ((59,59),(59,60),(60,59))    | <(59,59),59>
 66 | Miller                          | Lubbock or leave it                     | (33,1330),(3,1300)                          | ((66,660),(67,650),(68,660)) | <(66,66),66>
 70 |  Patty                          |  Cake                                   | (7052,250),(6050,20)                        | ((70,70),(70,60),(60,70))    | <(70,70),70>
 76 | James McMurtry                  | Levelland                               | (1700,1900),(1500,1500)                     | ((76,77),(76,75),(75,77))    | <(76,76),76>
 80 |  Leading space man              |  Leading space woman                    | (3,4),(1,2)                                 | ((80,80),(80,79),(79,80))    | <(80,80),80>
 81 | Trailing space man              | trailing space woman                    | (3,4),(1,2)                                 | ((81,81),(81,80),(80,81))    | <(81,81),81>
 82 |   Leading and trailing spaces   |   leading and trailing spaces           | (3,4),(1,2)                                 | ((82,82),(82,80),(80,82))    | <(82,82),82>
(19 rows)

-- test06IllegalonAO.sql
SET enable_seqscan = FALSE;
ALTER TABLE GistTable1 CLUSTER ON propertyBoxIndex;
ALTER INDEX propertyBoxIndex RENAME TO propIndex;
UPDATE GistTable1
 SET description = 'Where''s Johnny?', bullseye = NULL
 WHERE owner = 'James McMurtry';
-- We should no longer be able to find "Levelland".
SELECT property FROM GistTable1 
 WHERE description = 'Levelland';
 property 
----------
(0 rows)

ALTER INDEX propIndex SET (FILLFACTOR=50);
SELECT owner FROM GistTable1 
 WHERE property ~= '( (40, 20), (42, 25) )';
        owner         
----------------------
 Hyquotia P. Cucumber
(1 row)

REINDEX INDEX propIndex;
SELECT owner FROM GistTable1 
 WHERE property ~= '( (40, 20), (42, 25) )';
        owner         
----------------------
 Hyquotia P. Cucumber
(1 row)

-- Delete Theodore Turner
DELETE from GistTable1 WHERE property ~= '((2000,2000), (2100, 2100))';
SELECT id, owner, description, property, poli, bullseye FROM GistTable1 
 ORDER BY id;
 id |              owner              |               description               |                  property                   |             poli             |   bullseye   
----+---------------------------------+-----------------------------------------+---------------------------------------------+------------------------------+--------------
  1 | Snidely Whiplash                |  an empire dreamt of but as yet unbuilt | (1,1),(0,0)                                 | ((0,0),(1,1),(2,2),(3,3))    | <(0,0),0>
  3 | Theodore Roosevelt              |  overlooks Yellowstone River            | (1801,2201),(1800,2200)                     | ((3,3),(3,4),(4,3))          | <(3,3),3>
  4 | Donald Duck                     |  overlooks Colorado River               | (1001,1001),(1000,1000)                     | ((4,4),(4,5),(5,4),(5,5))    | <(4,4),4>
  5 | Roger Rabbit                    |  Toon Town, unit 127                    | (-999999,-100000),(-1000000,-999999)        | ((5,-1),(5,-2),(5,-5))       | <(5,5),5>
  6 | James T. Kirk                   |  Utopia Planetia                        | (123456790,123456790),(123456789,123456789) | ((6,7),(6,5),(5,7))          | <(6,6),6>
  7 | Albus Dumbledore                |  Hogwarts                               | (-11999990,-11999990),(-12000000,-12000000) | ((7,7),(7,8),(6,7))          | <(7,7),7>
  8 | Neil, Nell, and Noel Newall     |  Null Knoll                             |                                             |                              | 
  9 | Hyquotia P. Cucumber            | Radical Vegan Farms                     | (42,25),(40,20)                             | ((9,9),(9,8),(8,10))         | <(9,9),9>
 10 | Junipero Serra                  | California                              | (200,1000),(0,0)                            | ((10,10),(10,9),(8,11))      | <(10,10),10>
 18 | K. Serra                        | California                              | (200,1000),(0,0)                            | ((18,18),(18,19),(17,19))    | <(18,18),18>
 19 | Kay Serra                       | California                              | (200,1000),(0,0)                            | ((19,19),(19,18),(20,19))    | <(19,19),19>
 38 | Que Sera                        | California                              | (200,1000),(0,0)                            | ((38,38),(38,39),(37,38))    | <(38,38),38>
 59 | Hypatia                         | Greece                                  | (7052,250),(6050,20)                        | ((59,59),(59,60),(60,59))    | <(59,59),59>
 66 | Miller                          | Lubbock or leave it                     | (33,1330),(3,1300)                          | ((66,660),(67,650),(68,660)) | <(66,66),66>
 70 |  Patty                          |  Cake                                   | (7052,250),(6050,20)                        | ((70,70),(70,60),(60,70))    | <(70,70),70>
 76 | James McMurtry                  | Where's Johnny?                         | (1700,1900),(1500,1500)                     | ((76,77),(76,75),(75,77))    | 
 80 |  Leading space man              |  Leading space woman                    | (3,4),(1,2)                                 | ((80,80),(80,79),(79,80))    | <(80,80),80>
 81 | Trailing space man              | trailing space woman                    | (3,4),(1,2)                                 | ((81,81),(81,80),(80,81))    | <(81,81),81>
 82 |   Leading and trailing spaces   |   leading and trailing spaces           | (3,4),(1,2)                                 | ((82,82),(82,80),(80,82))    | <(82,82),82>
(19 rows)

-- Update James McMurtry.
UPDATE GistTable1 
 SET owner = 'Record Company', description = 'fat profit', 
   property = '((100,100), (200, 200))'
 WHERE property ~= '( (1700,1900),(1500,1500) )';
SELECT id, owner, description, property, poli, bullseye FROM GistTable1 
 ORDER BY id;
 id |              owner              |               description               |                  property                   |             poli             |   bullseye   
----+---------------------------------+-----------------------------------------+---------------------------------------------+------------------------------+--------------
  1 | Snidely Whiplash                |  an empire dreamt of but as yet unbuilt | (1,1),(0,0)                                 | ((0,0),(1,1),(2,2),(3,3))    | <(0,0),0>
  3 | Theodore Roosevelt              |  overlooks Yellowstone River            | (1801,2201),(1800,2200)                     | ((3,3),(3,4),(4,3))          | <(3,3),3>
  4 | Donald Duck                     |  overlooks Colorado River               | (1001,1001),(1000,1000)                     | ((4,4),(4,5),(5,4),(5,5))    | <(4,4),4>
  5 | Roger Rabbit                    |  Toon Town, unit 127                    | (-999999,-100000),(-1000000,-999999)        | ((5,-1),(5,-2),(5,-5))       | <(5,5),5>
  6 | James T. Kirk                   |  Utopia Planetia                        | (123456790,123456790),(123456789,123456789) | ((6,7),(6,5),(5,7))          | <(6,6),6>
  7 | Albus Dumbledore                |  Hogwarts                               | (-11999990,-11999990),(-12000000,-12000000) | ((7,7),(7,8),(6,7))          | <(7,7),7>
  8 | Neil, Nell, and Noel Newall     |  Null Knoll                             |                                             |                              | 
  9 | Hyquotia P. Cucumber            | Radical Vegan Farms                     | (42,25),(40,20)                             | ((9,9),(9,8),(8,10))         | <(9,9),9>
 10 | Junipero Serra                  | California                              | (200,1000),(0,0)                            | ((10,10),(10,9),(8,11))      | <(10,10),10>
 18 | K. Serra                        | California                              | (200,1000),(0,0)                            | ((18,18),(18,19),(17,19))    | <(18,18),18>
 19 | Kay Serra                       | California                              | (200,1000),(0,0)                            | ((19,19),(19,18),(20,19))    | <(19,19),19>
 38 | Que Sera                        | California                              | (200,1000),(0,0)                            | ((38,38),(38,39),(37,38))    | <(38,38),38>
 59 | Hypatia                         | Greece                                  | (7052,250),(6050,20)                        | ((59,59),(59,60),(60,59))    | <(59,59),59>
 66 | Miller                          | Lubbock or leave it                     | (33,1330),(3,1300)                          | ((66,660),(67,650),(68,660)) | <(66,66),66>
 70 |  Patty                          |  Cake                                   | (7052,250),(6050,20)                        | ((70,70),(70,60),(60,70))    | <(70,70),70>
 76 | Record Company                  | fat profit                              | (200,200),(100,100)                         | ((76,77),(76,75),(75,77))    | 
 80 |  Leading space man              |  Leading space woman                    | (3,4),(1,2)                                 | ((80,80),(80,79),(79,80))    | <(80,80),80>
 81 | Trailing space man              | trailing space woman                    | (3,4),(1,2)                                 | ((81,81),(81,80),(80,81))    | <(81,81),81>
 82 |   Leading and trailing spaces   |   leading and trailing spaces           | (3,4),(1,2)                                 | ((82,82),(82,80),(80,82))    | <(82,82),82>
(19 rows)

ALTER INDEX propIndex RENAME TO propertyBoxIndex;
SELECT id, owner, description, property, poli, bullseye FROM GistTable1 
 ORDER BY id;
 id |              owner              |               description               |                  property                   |             poli             |   bullseye   
----+---------------------------------+-----------------------------------------+---------------------------------------------+------------------------------+--------------
  1 | Snidely Whiplash                |  an empire dreamt of but as yet unbuilt | (1,1),(0,0)                                 | ((0,0),(1,1),(2,2),(3,3))    | <(0,0),0>
  3 | Theodore Roosevelt              |  overlooks Yellowstone River            | (1801,2201),(1800,2200)                     | ((3,3),(3,4),(4,3))          | <(3,3),3>
  4 | Donald Duck                     |  overlooks Colorado River               | (1001,1001),(1000,1000)                     | ((4,4),(4,5),(5,4),(5,5))    | <(4,4),4>
  5 | Roger Rabbit                    |  Toon Town, unit 127                    | (-999999,-100000),(-1000000,-999999)        | ((5,-1),(5,-2),(5,-5))       | <(5,5),5>
  6 | James T. Kirk                   |  Utopia Planetia                        | (123456790,123456790),(123456789,123456789) | ((6,7),(6,5),(5,7))          | <(6,6),6>
  7 | Albus Dumbledore                |  Hogwarts                               | (-11999990,-11999990),(-12000000,-12000000) | ((7,7),(7,8),(6,7))          | <(7,7),7>
  8 | Neil, Nell, and Noel Newall     |  Null Knoll                             |                                             |                              | 
  9 | Hyquotia P. Cucumber            | Radical Vegan Farms                     | (42,25),(40,20)                             | ((9,9),(9,8),(8,10))         | <(9,9),9>
 10 | Junipero Serra                  | California                              | (200,1000),(0,0)                            | ((10,10),(10,9),(8,11))      | <(10,10),10>
 18 | K. Serra                        | California                              | (200,1000),(0,0)                            | ((18,18),(18,19),(17,19))    | <(18,18),18>
 19 | Kay Serra                       | California                              | (200,1000),(0,0)                            | ((19,19),(19,18),(20,19))    | <(19,19),19>
 38 | Que Sera                        | California                              | (200,1000),(0,0)                            | ((38,38),(38,39),(37,38))    | <(38,38),38>
 59 | Hypatia                         | Greece                                  | (7052,250),(6050,20)                        | ((59,59),(59,60),(60,59))    | <(59,59),59>
 66 | Miller                          | Lubbock or leave it                     | (33,1330),(3,1300)                          | ((66,660),(67,650),(68,660)) | <(66,66),66>
 70 |  Patty                          |  Cake                                   | (7052,250),(6050,20)                        | ((70,70),(70,60),(60,70))    | <(70,70),70>
 76 | Record Company                  | fat profit                              | (200,200),(100,100)                         | ((76,77),(76,75),(75,77))    | 
 80 |  Leading space man              |  Leading space woman                    | (3,4),(1,2)                                 | ((80,80),(80,79),(79,80))    | <(80,80),80>
 81 | Trailing space man              | trailing space woman                    | (3,4),(1,2)                                 | ((81,81),(81,80),(80,81))    | <(81,81),81>
 82 |   Leading and trailing spaces   |   leading and trailing spaces           | (3,4),(1,2)                                 | ((82,82),(82,80),(80,82))    | <(82,82),82>
(19 rows)

DELETE FROM GistTable1 WHERE bullseye = '( (76, 76), 76)';
-- test07select.sql
SET enable_seqscan = FALSE;
SELECT id, owner, description, property, poli, bullseye FROM GistTable1
 WHERE property IS NOT NULL
 ORDER BY id;
 id |              owner              |               description               |                  property                   |             poli             |   bullseye   
----+---------------------------------+-----------------------------------------+---------------------------------------------+------------------------------+--------------
  1 | Snidely Whiplash                |  an empire dreamt of but as yet unbuilt | (1,1),(0,0)                                 | ((0,0),(1,1),(2,2),(3,3))    | <(0,0),0>
  3 | Theodore Roosevelt              |  overlooks Yellowstone River            | (1801,2201),(1800,2200)                     | ((3,3),(3,4),(4,3))          | <(3,3),3>
  4 | Donald Duck                     |  overlooks Colorado River               | (1001,1001),(1000,1000)                     | ((4,4),(4,5),(5,4),(5,5))    | <(4,4),4>
  5 | Roger Rabbit                    |  Toon Town, unit 127                    | (-999999,-100000),(-1000000,-999999)        | ((5,-1),(5,-2),(5,-5))       | <(5,5),5>
  6 | James T. Kirk                   |  Utopia Planetia                        | (123456790,123456790),(123456789,123456789) | ((6,7),(6,5),(5,7))          | <(6,6),6>
  7 | Albus Dumbledore                |  Hogwarts                               | (-11999990,-11999990),(-12000000,-12000000) | ((7,7),(7,8),(6,7))          | <(7,7),7>
  9 | Hyquotia P. Cucumber            | Radical Vegan Farms                     | (42,25),(40,20)                             | ((9,9),(9,8),(8,10))         | <(9,9),9>
 10 | Junipero Serra                  | California                              | (200,1000),(0,0)                            | ((10,10),(10,9),(8,11))      | <(10,10),10>
 18 | K. Serra                        | California                              | (200,1000),(0,0)                            | ((18,18),(18,19),(17,19))    | <(18,18),18>
 19 | Kay Serra                       | California                              | (200,1000),(0,0)                            | ((19,19),(19,18),(20,19))    | <(19,19),19>
 38 | Que Sera                        | California                              | (200,1000),(0,0)                            | ((38,38),(38,39),(37,38))    | <(38,38),38>
 59 | Hypatia                         | Greece                                  | (7052,250),(6050,20)                        | ((59,59),(59,60),(60,59))    | <(59,59),59>
 66 | Miller                          | Lubbock or leave it                     | (33,1330),(3,1300)                          | ((66,660),(67,650),(68,660)) | <(66,66),66>
 70 |  Patty                          |  Cake                                   | (7052,250),(6050,20)                        | ((70,70),(70,60),(60,70))    | <(70,70),70>
 76 | Record Company                  | fat profit                              | (200,200),(100,100)                         | ((76,77),(76,75),(75,77))    | 
 80 |  Leading space man              |  Leading space woman                    | (3,4),(1,2)                                 | ((80,80),(80,79),(79,80))    | <(80,80),80>
 81 | Trailing space man              | trailing space woman                    | (3,4),(1,2)                                 | ((81,81),(81,80),(80,81))    | <(81,81),81>
 82 |   Leading and trailing spaces   |   leading and trailing spaces           | (3,4),(1,2)                                 | ((82,82),(82,80),(80,82))    | <(82,82),82>
(18 rows)

--test08UniqueandPKey.sql
ALTER TABLE GistTable1 ADD CONSTRAINT pkey PRIMARY KEY (property); 
ERROR:  data type box has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
ALTER TABLE GistTable1 ADD CONSTRAINT pkey PRIMARY KEY (poli); 
ERROR:  data type polygon has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
ALTER TABLE GistTable1 ADD CONSTRAINT pkey PRIMARY KEY (bullseye); 
ERROR:  data type circle has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
ALTER TABLE GistTable1 ADD CONSTRAINT uniq UNIQUE (property); 
ERROR:  data type box has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
ALTER TABLE GistTable1 ADD CONSTRAINT uniq UNIQUE (poli); 
ERROR:  data type polygon has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
ALTER TABLE GistTable1 ADD CONSTRAINT uniq UNIQUE (bullseye); 
ERROR:  data type circle has no default operator class for access method "btree"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
CREATE UNIQUE INDEX ShouldNotExist ON GistTable1 USING GiST (property);
ERROR:  access method "gist" does not support unique indexes
CREATE UNIQUE INDEX ShouldNotExist ON GistTable1 USING GiST (poli);
ERROR:  access method "gist" does not support unique indexes
CREATE UNIQUE INDEX ShouldNotExist ON GistTable1 USING GiST (bullseye);
ERROR:  access method "gist" does not support unique indexes
-- start_ignore
DROP TABLE IF EXISTS GistTable2;
NOTICE:  table "gisttable2" does not exist, skipping
-- end_ignore
-- Test whether geometric types can be part of a primary key.
CREATE TABLE GistTable2 (id INTEGER, property BOX)
 DISTRIBUTED BY (property);
ERROR:  type "box" can't be a part of a distribution key
CREATE TABLE GistTable2 (id INTEGER, poli POLYGON)
 DISTRIBUTED BY (poli);
ERROR:  type "polygon" can't be a part of a distribution key
CREATE TABLE GistTable2 (id INTEGER, bullseye CIRCLE)
 DISTRIBUTED BY (bullseye);
ERROR:  type "circle" can't be a part of a distribution key
-- start_ignore
DROP TABLE IF EXISTS GistTable2;
NOTICE:  table "gisttable2" does not exist, skipping
-- end_ignore
-- test09NegativeTests.sql
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (id);
ERROR:  data type integer has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (v);
ERROR:  data type character varying has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (t);
ERROR:  data type text has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (f);
ERROR:  data type double precision has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (p);
ERROR:  data type point has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
-- Try to create GiST indexes on a mix of geometric and 
-- non-geometric types.
CREATE INDEX ShouldNotExist ON GistTable1 USING GiST (c, f);
ERROR:  data type double precision has no default operator class for access method "gist"
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
-- test10MultipleColumns.sql
SET enable_seqscan = FALSE;
-- Insert 2 more records, but insert them with the same value for BULLSEYE.
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye) 
 VALUES (212, 'Fahrenheit', 'Slightly north of Hades', '( (212, 212), (32, 32) )', '( (212, 212), (600, 600), (70, 70) )', '( (100,100), 212 )' );
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye) 
 VALUES (100, 'Celsius', 'Barely north of Hades', '( (100, 100), (0, 0) )', '( (100, 100), (600, 600), (70, 70) )', '( (100,100), 212 )' );
-- This should create an index that has duplicate entries for at least one 
--  value of bullseye.
CREATE INDEX i2 ON GistTable1 USING GIST(bullseye);
CREATE INDEX i3 ON GistTable1 USING GIST(poli, bullseye);
-- This should return 2 rows.
SELECT id FROM GistTable1
 WHERE bullseye ~= '( (100,100), 212 )';
 id  
-----
 212
 100
(2 rows)

-- This should return 1 row.
SELECT id FROM GistTable1
 WHERE property ~= '( (212, 212), (32, 32) )';
 id  
-----
 212
(1 row)

-- test11WherePredicate.sql
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye)
 VALUES (77, 'S. T. "Rip" Sunset', 'Lost Vegas',NULL,
   '( (77, 77), (76, 78), (78, 76) )', '( (77, 77), 77)' );
CREATE INDEX propertyIsNullIndex ON GistTable1 USING Gist (property)
 WHERE property IS NULL;
-- Add two more records that have NULL in the property field.
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye)
 VALUES (86, 'A. Gent', 'Washingtoon D.C.',NULL,
   '( (86, 86), (85, 87), (87, 85) )', '( (86, 86), 86)' );
INSERT INTO GistTable1 (id, owner, description, property, poli, bullseye)
 VALUES (99, 'FelDon Adams', 'Washingtoon D.C.',NULL,
   '( (99, 99), (97, 98), (98, 97) )', '( (99, 99), 99)' );
SET enable_seqscan = FALSE;
-- We should be able to search the column that uses a geometric data type, 
-- and of course we should find the right rows.  We should be able to search 
-- using different "formats" (e.g. spacing) of the data, and in some cases 
-- even different "order" of the data (if the data is converted to a 
-- canonical form, as it is for the BOX data type and perhaps some other 
-- data types), as long as data in all of those formats should be converted 
-- to the same internal representation.
SELECT owner, property FROM GistTable1 
 WHERE property IS NULL;
            owner            | property 
-----------------------------+----------
 S. T. "Rip" Sunset          | 
 FelDon Adams                | 
 Neil, Nell, and Noel Newall | 
 A. Gent                     | 
(4 rows)

--start_ignore
EXPLAIN 
SELECT owner, property FROM GistTable1 
 WHERE property IS NULL
 ORDER BY id
 ;
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=200.28..200.28 rows=1 width=68)
   Merge Key: "?column3?"
   ->  Sort  (cost=200.28..200.28 rows=1 width=68)
         Sort Key: id
         ->  Index Scan using propertyisnullindex on gisttable1  (cost=0.00..200.27 rows=1 width=68)
 Settings:  enable_seqscan=off
(6 rows)

--end_ignore
-- Alter the table and see if we get the same results.
ALTER TABLE GistTable1 CLUSTER ON propertyBoxIndex;
SELECT id, property FROM GistTable1 
 WHERE property IS NULL 
 ORDER BY id
 ;
 id | property 
----+----------
  8 | 
 77 | 
 86 | 
 99 | 
(4 rows)

--start_ignore
EXPLAIN
SELECT id, property FROM GistTable1 
 WHERE property IS NULL 
 ORDER BY id
 ;
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=200.28..200.28 rows=1 width=36)
   Merge Key: id
   ->  Sort  (cost=200.28..200.28 rows=1 width=36)
         Sort Key: id
         ->  Index Scan using propertyisnullindex on gisttable1  (cost=0.00..200.27 rows=1 width=36)
 Settings:  enable_seqscan=off
(6 rows)

--end_ignore
-- test12expression.sql
INSERT INTO GistTable1 (id, box1) VALUES (300, '( (1, 1), (2, 2) )');
ERROR:  column "box1" of relation "gisttable1" does not exist
LINE 1: INSERT INTO GistTable1 (id, box1) VALUES (300, '( (1, 1), (2...
                                    ^
INSERT INTO GistTable1 (id, box1) VALUES (301, '( (3, 4), (4, 5) )');
ERROR:  column "box1" of relation "gisttable1" does not exist
LINE 1: INSERT INTO GistTable1 (id, box1) VALUES (301, '( (3, 4), (4...
                                    ^
INSERT INTO GistTable1 (id, box1) VALUES (302, '( (2, 2), (20, 20) )');
ERROR:  column "box1" of relation "gisttable1" does not exist
LINE 1: INSERT INTO GistTable1 (id, box1) VALUES (302, '( (2, 2), (2...
                                    ^
INSERT INTO GistTable1 (id, box1) VALUES (304, '( (2, 2), (4, 4) )');
ERROR:  column "box1" of relation "gisttable1" does not exist
LINE 1: INSERT INTO GistTable1 (id, box1) VALUES (304, '( (2, 2), (4...
                                    ^
-- You can create an index on an expression:
CREATE INDEX exampleExpressionIndex on GistTable1 ((id * 2));
CREATE INDEX boxIndex1 ON GistTable1 USING Gist ((box1 * POINT '(2.0, 0)'));
ERROR:  column "box1" does not exist
LINE 1: CREATE INDEX boxIndex1 ON GistTable1 USING Gist ((box1 * POI...
                                                          ^
SET enable_seqscan = FALSE;
-- We should be able to search the column that uses an expression that uses 
-- a geometric data type, and of course we should find the right rows.  
-- This uses the index, as it should.
SELECT id, box1 FROM GistTable1
 WHERE (box1 * POINT '(2.0, 0)' ) ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)');
ERROR:  column "box1" does not exist
LINE 1: SELECT id, box1 FROM GistTable1
                   ^
--start_ignore
EXPLAIN SELECT id, box1 FROM GistTable1
 WHERE (box1 * POINT '(2.0, 0)' ) ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)');
ERROR:  column "box1" does not exist
LINE 1: EXPLAIN SELECT id, box1 FROM GistTable1
                           ^
--end_ignore
-- It seems to me that this could use the index, but it doesn't.  
-- The reason that I think this can use the index is that the index expression 
-- evaluates to a box, and the right-hand side of the WHERE clause below 
-- evaluates to a box, so the server should be able to search for the 
-- expression on the right-hand side by using the index.  
-- The fact that this doesn't use an index suggests that there's a bug!!!
SELECT id, box1 FROM GistTable1
 WHERE box1 ~= BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)';
ERROR:  column "box1" does not exist
LINE 1: SELECT id, box1 FROM GistTable1
                   ^
--start_ignore
EXPLAIN SELECT id, box1 FROM GistTable1
 WHERE box1 ~= BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)';
ERROR:  column "box1" does not exist
LINE 1: EXPLAIN SELECT id, box1 FROM GistTable1
                           ^
--end_ignore
-- It seems to me that this could use the index, but it doesn't.
SELECT id, box1 FROM GistTable1
 WHERE (box1 * POINT '(2.0, 0)' ) ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)') 
  OR 
   box1 ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)')
   ;
ERROR:  column "box1" does not exist
LINE 1: SELECT id, box1 FROM GistTable1
                   ^
--start_ignore
EXPLAIN SELECT id, box1 FROM GistTable1 WHERE (box1 * POINT '(2.0, 0)' ) ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)') OR box1 ~= (BOX '( (1,1), (2,2) )' * POINT '(2.0, 0)');
ERROR:  column "box1" does not exist
LINE 1: EXPLAIN SELECT id, box1 FROM GistTable1 WHERE (box1 * POINT ...
                           ^
--end_ignore
-- test13Vaccum.sql
-- start_ignore
DROP TABLE IF EXISTS GistTable13;
NOTICE:  table "gisttable13" does not exist, skipping
DROP FUNCTION IF EXISTS TO_BOX(TEXT) CASCADE;
NOTICE:  function to_box(text) does not exist, skipping
DROP FUNCTION IF EXISTS insertIntoGistTable13(INTEGER);
NOTICE:  function insertintogisttable13(pg_catalog.int4) does not exist, skipping
DROP FUNCTION IF EXISTS insertManyIntoGistTable13(INTEGER, INTEGER);
NOTICE:  function insertmanyintogisttable13(pg_catalog.int4,pg_catalog.int4) does not exist, skipping
-- end_ignore
CREATE TABLE GistTable13 (
 id INTEGER,
 property BOX,
 filler VARCHAR DEFAULT 'This is here just to take up space so that we use more pages of data and sequential scans take a lot more time.  Stones tinheads and mixers coming; we did it all on our own; this summer I hear the crunching; 11 dead in Ohio. Got right down to it; we were cutting us down; could have had fun but, no; left them face down dead on the ground.  How can you listen when you know?' 
 )
 DISTRIBUTED BY (id);
-- Register a function that converts TEXT to BOX data type.
CREATE FUNCTION TO_BOX(TEXT) RETURNS BOX AS
  $$
    SELECT box_in(textout($1))
  $$ LANGUAGE SQL CONTAINS SQL;
CREATE FUNCTION insertIntoGistTable13 (seed INTEGER) RETURNS VOID
AS
$$
DECLARE 
   str1 VARCHAR;
   ss VARCHAR;
   s2 VARCHAR;
BEGIN
   ss = CAST(seed AS VARCHAR);
   s2 = CAST((seed - 1) AS VARCHAR);
   str1 = '((' || ss || ', ' || ss || '), (' || s2 || ', ' || s2 || '))';
   INSERT INTO GistTable13(id, property) VALUES (seed, TO_BOX(CAST(str1 AS TEXT)) );
END;
$$
LANGUAGE PLPGSQL MODIFIES SQL DATA
;
CREATE FUNCTION insertManyIntoGistTable13 (startValue INTEGER, endValue INTEGER) RETURNS VOID
AS
$$
DECLARE 
   i INTEGER;
BEGIN
   i = startValue;
   WHILE i <= endValue LOOP
       PERFORM insertIntoGistTable13(i);
       i = i + 1;
   END LOOP;
END;
$$
LANGUAGE PLPGSQL MODIFIES SQL DATA
;
-- Add some rows before we create the index.
SELECT insertManyIntoGistTable13(1, 1000);
 insertmanyintogisttable13 
---------------------------
 
(1 row)

-- Create the index.
CREATE INDEX GistIndex13 ON GistTable13 USING GiST (property);
SET enable_seqscan = FALSE;
-- Add more rows after we create the index.
SELECT insertManyIntoGistTable13(1001, 2000);
 insertmanyintogisttable13 
---------------------------
 
(1 row)

-- Delete half the rows (the rows with even-numbered ids).
DELETE FROM GistTable13 WHERE id %2 = 0;
-- There should be about 1000 rows left.
SELECT COUNT(*) FROM GistTable13;
 count 
-------
  1000
(1 row)

--start_ignore
ANALYZE GistTable13;
--end_ignore
-- Note that "=" for geometric data types means equal AREA, NOT COORDINATES.
-- The "~=" operator means that the values (coordinates), not just the 
-- AREA, are the same.
SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
 id  |      ProperTee      
-----+---------------------
 999 | (999,999),(998,998)
(1 row)

--start_ignore
EXPLAIN SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..200.27 rows=1 width=36)
   ->  Index Scan using gistindex13 on gisttable13  (cost=0.00..200.27 rows=1 width=36)
         Index Cond: property ~= '(999,999),(998,998)'::box
 Settings:  enable_seqscan=off
(4 rows)

--end_ignore
--start_ignore
VACUUM GistTable13;
--end_ignore
--start_ignore
ANALYZE GistTable13;
--end_ignore
SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
 id  |      ProperTee      
-----+---------------------
 999 | (999,999),(998,998)
(1 row)

--start_ignore
EXPLAIN SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..200.27 rows=1 width=36)
   ->  Index Scan using gistindex13 on gisttable13  (cost=0.00..200.27 rows=1 width=36)
         Index Cond: property ~= '(999,999),(998,998)'::box
 Settings:  enable_seqscan=off
(4 rows)

--end_ignore
TRUNCATE TABLE GistTable13;
-- Add some rows.
SELECT insertManyIntoGistTable13(1, 1000);
 insertmanyintogisttable13 
---------------------------
 
(1 row)

--start_ignore
ANALYZE GistTable13;
--end_ignore
-- Note that "=" for geometric data types means equal AREA, NOT COORDINATES.
-- The "~=" operator means that the values are the same, not just the 
-- same AREA.
SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
 id  |      ProperTee      
-----+---------------------
 999 | (999,999),(998,998)
(1 row)

--start_ignore
EXPLAIN SELECT id, property AS "ProperTee" FROM GistTable13 
 WHERE property ~= '( (999,999), (998,998) )';
                                       QUERY PLAN                                       
----------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..200.27 rows=1 width=36)
   ->  Index Scan using gistindex13 on gisttable13  (cost=0.00..200.27 rows=1 width=36)
         Index Cond: property ~= '(999,999),(998,998)'::box
 Settings:  enable_seqscan=off
(4 rows)

--end_ignore
-- start_ignore
DROP TABLE IF EXISTS GistTable13;
-- end_ignore
-- test14Hash.sql
-- start_ignore
DROP TABLE IF EXISTS GistTable14;
NOTICE:  table "gisttable14" does not exist, skipping
-- end_ignore
CREATE TABLE GistTable14 (
 id INTEGER,
 property BOX
 )
 DISTRIBUTED BY (id);
-- Try to create a hash index.
CREATE INDEX GistIndex14a ON GistTable14 USING HASH (id);
ERROR:  hash indexes are not supported
CREATE INDEX GistIndex14b ON GistTable14 USING HASH (property);
ERROR:  hash indexes are not supported
-- start_ignore
DROP TABLE IF EXISTS GistTable14;
-- end_ignore
