-- 
-- @created 2009-01-27 14:00:00
-- @modified 2013-06-24 17:00:00
-- @tags ddl schema_topology
-- @description  Defining Multi-level Partitions
create database partition_db;
CREATE DATABASE
\c partition_db
You are now connected to database "partition_db" as user "nbhojwani".
 
CREATE TABLE sales (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
SUBPARTITION BY LIST (region) 
SUBPARTITION TEMPLATE 
( SUBPARTITION usa VALUES ('usa'),  
  SUBPARTITION asia VALUES ('asia'),  
  SUBPARTITION europe VALUES ('europe') ) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month') ); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_1" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_2" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_3" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_4" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_5" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_6" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_7" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_8" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_9" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_10" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_11" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_12" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_1_2_prt_usa" for table "sales_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_1_2_prt_asia" for table "sales_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_1_2_prt_europe" for table "sales_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_usa" for table "sales_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_asia" for table "sales_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_2_2_prt_europe" for table "sales_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_usa" for table "sales_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_asia" for table "sales_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_3_2_prt_europe" for table "sales_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_usa" for table "sales_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_asia" for table "sales_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_4_2_prt_europe" for table "sales_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_usa" for table "sales_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_asia" for table "sales_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_5_2_prt_europe" for table "sales_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_usa" for table "sales_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_asia" for table "sales_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_6_2_prt_europe" for table "sales_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_usa" for table "sales_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_asia" for table "sales_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_7_2_prt_europe" for table "sales_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_usa" for table "sales_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_asia" for table "sales_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_8_2_prt_europe" for table "sales_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_usa" for table "sales_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_asia" for table "sales_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_9_2_prt_europe" for table "sales_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_usa" for table "sales_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_asia" for table "sales_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_10_2_prt_europe" for table "sales_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_usa" for table "sales_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_asia" for table "sales_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_11_2_prt_europe" for table "sales_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_usa" for table "sales_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_asia" for table "sales_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_europe" for table "sales_1_prt_12"
CREATE TABLE
insert into sales values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'europe');
INSERT 0 10000
insert into sales values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'europe');
INSERT 0 10000
-- Partitioning an Existing Table
CREATE TABLE sales1 (LIKE sales) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month') );
psql:/path/sql_file:1: NOTICE:  Table doesn't have 'distributed by' clause, defaulting to distribution columns from LIKE table
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_1" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_2" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_3" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_4" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_5" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_6" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_7" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_8" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_9" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_10" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_11" for table "sales1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales1_1_prt_12" for table "sales1"
CREATE TABLE
INSERT INTO sales1 SELECT * FROM sales; 
INSERT 0 60000
-- Verifying Your Partition Strategy 
EXPLAIN SELECT * FROM sales WHERE date='01-07-08' AND 
region='usa';
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..55.28 rows=1 width=53)
   ->  Append  (cost=0.00..55.28 rows=1 width=53)
         ->  Seq Scan on sales_1_prt_1_2_prt_usa sales  (cost=0.00..55.28 rows=1 width=53)
               Filter: date = '2008-01-07'::date AND region = 'usa'::text
(4 rows)

--Viewing Your Partition Design 
SELECT partitionboundary, partitiontablename, partitionname, 
partitionlevel, partitionrank FROM pg_partitions WHERE 
tablename='sales'; 
                               partitionboundary                               |     partitiontablename      | partitionname | partitionlevel | partitionrank 
-------------------------------------------------------------------------------+-----------------------------+---------------+----------------+---------------
 START ('2008-01-01'::date) END ('2008-02-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_1               |               |              0 |             1
 START ('2008-02-01'::date) END ('2008-03-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_2               |               |              0 |             2
 START ('2008-03-01'::date) END ('2008-04-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_3               |               |              0 |             3
 START ('2008-04-01'::date) END ('2008-05-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_4               |               |              0 |             4
 START ('2008-05-01'::date) END ('2008-06-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_5               |               |              0 |             5
 START ('2008-06-01'::date) END ('2008-07-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_6               |               |              0 |             6
 START ('2008-07-01'::date) END ('2008-08-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_7               |               |              0 |             7
 START ('2008-08-01'::date) END ('2008-09-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_8               |               |              0 |             8
 START ('2008-09-01'::date) END ('2008-10-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_9               |               |              0 |             9
 START ('2008-10-01'::date) END ('2008-11-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_10              |               |              0 |            10
 START ('2008-11-01'::date) END ('2008-12-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_11              |               |              0 |            11
 START ('2008-12-01'::date) END ('2009-01-01'::date) EVERY ('1 mon'::interval) | sales_1_prt_12              |               |              0 |            12
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_1_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_1_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_1_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_10_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_10_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_10_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_11_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_11_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_11_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_12_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_12_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_12_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_2_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_2_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_2_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_3_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_3_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_3_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_4_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_4_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_4_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_5_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_5_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_5_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_6_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_6_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_6_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_7_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_7_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_7_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_8_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_8_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_8_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa')                                                | sales_1_prt_9_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia')                                              | sales_1_prt_9_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe')                                          | sales_1_prt_9_2_prt_europe  | europe        |              1 |              
(48 rows)

-- Adding a New Partition 
ALTER TABLE sales ALTER PARTITION FOR (RANK(12)) 
      ADD PARTITION africa VALUES ('africa');
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_12_2_prt_africa" for table "sales_1_prt_12"
ALTER TABLE
-- Adding a Default Partition
ALTER TABLE sales ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_other" for table "sales"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_other_2_prt_usa" for table "sales_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_other_2_prt_asia" for table "sales_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_other_2_prt_europe" for table "sales_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_1_prt_other_2_prt_africa" for table "sales_1_prt_other"
ALTER TABLE
insert into sales values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'europe');
INSERT 0 10000
-- Renaming a Partition
--ALTER TABLE sales RENAME PARTITION FOR ('2008-01-01') TO jan08;
ALTER TABLE sales RENAME PARTITION FOR (RANK(1)) TO jan08;
ALTER TABLE
-- Dropping a Partition
ALTER TABLE sales DROP PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  dropped partition "jan08" for relation "sales" and its children
ALTER TABLE
-- Truncating a Partition
ALTER TABLE sales TRUNCATE PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  truncated partition for rank 1 for relation "sales" and its children
ALTER TABLE
-- Exchanging a Partition
CREATE TABLE sales2 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month') ); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_1" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_2" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_3" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_4" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_5" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_6" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_7" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_8" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_9" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_10" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_11" for table "sales2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales2_1_prt_12" for table "sales2"
CREATE TABLE
insert into sales2 values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales2 values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales2 values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'europe');
INSERT 0 10000
CREATE TABLE jan08 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) ;
CREATE TABLE
ALTER TABLE sales2 EXCHANGE PARTITION FOR ('2008-01-01') WITH 
TABLE jan08;
ALTER TABLE
-- Splitting a Partition
CREATE TABLE sales3 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month') ); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_1" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_2" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_3" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_4" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_5" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_6" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_7" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_8" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_9" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_10" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_11" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_12" for table "sales3"
CREATE TABLE
ALTER TABLE sales3 SPLIT PARTITION FOR ('2008-01-01') 
AT ('2008-01-16') 
INTO (PARTITION jan081to15, PARTITION jan0816to31);
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_jan081to15" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_jan0816to31" for table "sales3"
ALTER TABLE
ALTER TABLE sales3 ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_other" for table "sales3"
ALTER TABLE
ALTER TABLE sales3 SPLIT DEFAULT PARTITION 
START ('2009-01-01') INCLUSIVE 
END ('2009-02-01') EXCLUSIVE 
INTO (PARTITION jan09, PARTITION other);
psql:/path/sql_file:1: NOTICE:  exchanged partition "other" of relation "sales3" with relation "pg_temp_73898"
psql:/path/sql_file:1: NOTICE:  dropped partition "other" for relation "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_jan09" for table "sales3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales3_1_prt_other" for table "sales3"
ALTER TABLE
---------------------
--AO Partitions
---------------------
CREATE TABLE sales_ao (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
SUBPARTITION BY LIST (region) 
SUBPARTITION TEMPLATE 
( SUBPARTITION usa VALUES ('usa'),  
  SUBPARTITION asia VALUES ('asia'),  
  SUBPARTITION europe VALUES ('europe') ) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_1" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_2" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_3" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_4" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_5" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_6" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_7" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_8" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_9" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_10" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_11" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_12" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_1_2_prt_usa" for table "sales_ao_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_1_2_prt_asia" for table "sales_ao_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_1_2_prt_europe" for table "sales_ao_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_2_2_prt_usa" for table "sales_ao_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_2_2_prt_asia" for table "sales_ao_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_2_2_prt_europe" for table "sales_ao_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_3_2_prt_usa" for table "sales_ao_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_3_2_prt_asia" for table "sales_ao_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_3_2_prt_europe" for table "sales_ao_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_4_2_prt_usa" for table "sales_ao_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_4_2_prt_asia" for table "sales_ao_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_4_2_prt_europe" for table "sales_ao_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_5_2_prt_usa" for table "sales_ao_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_5_2_prt_asia" for table "sales_ao_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_5_2_prt_europe" for table "sales_ao_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_6_2_prt_usa" for table "sales_ao_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_6_2_prt_asia" for table "sales_ao_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_6_2_prt_europe" for table "sales_ao_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_7_2_prt_usa" for table "sales_ao_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_7_2_prt_asia" for table "sales_ao_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_7_2_prt_europe" for table "sales_ao_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_8_2_prt_usa" for table "sales_ao_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_8_2_prt_asia" for table "sales_ao_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_8_2_prt_europe" for table "sales_ao_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_9_2_prt_usa" for table "sales_ao_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_9_2_prt_asia" for table "sales_ao_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_9_2_prt_europe" for table "sales_ao_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_10_2_prt_usa" for table "sales_ao_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_10_2_prt_asia" for table "sales_ao_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_10_2_prt_europe" for table "sales_ao_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_11_2_prt_usa" for table "sales_ao_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_11_2_prt_asia" for table "sales_ao_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_11_2_prt_europe" for table "sales_ao_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_12_2_prt_usa" for table "sales_ao_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_12_2_prt_asia" for table "sales_ao_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_12_2_prt_europe" for table "sales_ao_1_prt_12"
CREATE TABLE
insert into sales_ao values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales_ao values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales_ao values(generate_series(1,10000),'2008-01-01',generate_series(1,10000), 'europe');
INSERT 0 10000
insert into sales_ao values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales_ao values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales_ao values(generate_series(10001,20000),'2008-06-01',generate_series(1,10000), 'europe');
INSERT 0 10000
-- Partitioning an Existing Table
CREATE TABLE sales_ao1 (LIKE sales_ao) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5));
psql:/path/sql_file:1: NOTICE:  Table doesn't have 'distributed by' clause, defaulting to distribution columns from LIKE table
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_1" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_2" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_3" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_4" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_5" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_6" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_7" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_8" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_9" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_10" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_11" for table "sales_ao1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao1_1_prt_12" for table "sales_ao1"
CREATE TABLE
INSERT INTO sales_ao1 SELECT * FROM sales_ao; 
INSERT 0 60000
-- Verifying Your Partition Strategy 
EXPLAIN SELECT * FROM sales_ao WHERE date='01-07-08' AND 
region='usa';
                                               QUERY PLAN                                               
--------------------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..6.91 rows=1 width=53)
   ->  Append  (cost=0.00..6.91 rows=1 width=53)
         ->  Append-only Scan on sales_ao_1_prt_1_2_prt_usa sales_ao  (cost=0.00..6.91 rows=1 width=53)
               Filter: date = '2008-01-07'::date AND region = 'usa'::text
(4 rows)

--Viewing Your Partition Design 
SELECT partitionboundary, partitiontablename, partitionname, 
partitionlevel, partitionrank FROM pg_partitions WHERE 
tablename='sales_ao'; 
                                                   partitionboundary                                                   |       partitiontablename       | partitionname | partitionlevel | partitionrank 
-----------------------------------------------------------------------------------------------------------------------+--------------------------------+---------------+----------------+---------------
 START ('2008-01-01'::date) END ('2008-02-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_1               |               |              0 |             1
 START ('2008-02-01'::date) END ('2008-03-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_2               |               |              0 |             2
 START ('2008-03-01'::date) END ('2008-04-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_3               |               |              0 |             3
 START ('2008-04-01'::date) END ('2008-05-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_4               |               |              0 |             4
 START ('2008-05-01'::date) END ('2008-06-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_5               |               |              0 |             5
 START ('2008-06-01'::date) END ('2008-07-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_6               |               |              0 |             6
 START ('2008-07-01'::date) END ('2008-08-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_7               |               |              0 |             7
 START ('2008-08-01'::date) END ('2008-09-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_8               |               |              0 |             8
 START ('2008-09-01'::date) END ('2008-10-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_9               |               |              0 |             9
 START ('2008-10-01'::date) END ('2008-11-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_10              |               |              0 |            10
 START ('2008-11-01'::date) END ('2008-12-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_11              |               |              0 |            11
 START ('2008-12-01'::date) END ('2009-01-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_ao_1_prt_12              |               |              0 |            12
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_1_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_1_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_1_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_10_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_10_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_10_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_11_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_11_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_11_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_12_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_12_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_12_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_2_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_2_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_2_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_3_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_3_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_3_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_4_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_4_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_4_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_5_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_5_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_5_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_6_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_6_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_6_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_7_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_7_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_7_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_8_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_8_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_8_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_ao_1_prt_9_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_ao_1_prt_9_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_ao_1_prt_9_2_prt_europe  | europe        |              1 |              
(48 rows)

-- Adding a New Partition 
ALTER TABLE sales_ao ALTER PARTITION FOR (RANK(12)) 
      ADD PARTITION africa VALUES ('africa');
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_12_2_prt_africa" for table "sales_ao_1_prt_12"
ALTER TABLE
-- Adding a Default Partition
ALTER TABLE sales_ao ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_other" for table "sales_ao"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_other_2_prt_usa" for table "sales_ao_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_other_2_prt_asia" for table "sales_ao_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_other_2_prt_europe" for table "sales_ao_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao_1_prt_other_2_prt_africa" for table "sales_ao_1_prt_other"
ALTER TABLE
insert into sales_ao values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'usa');
INSERT 0 10000
insert into sales_ao values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'asia');
INSERT 0 10000
insert into sales_ao values(generate_series(1,10000),'2009-01-01',generate_series(1,10000), 'europe');
INSERT 0 10000
-- Renaming a Partition
--ALTER TABLE sales_ao RENAME PARTITION FOR ('2008-01-01') TO jan08;
ALTER TABLE sales_ao RENAME PARTITION FOR (RANK(1)) TO jan08;
ALTER TABLE
-- Dropping a Partition
ALTER TABLE sales_ao DROP PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  dropped partition "jan08" for relation "sales_ao" and its children
ALTER TABLE
-- Truncating a Partition
ALTER TABLE sales_ao TRUNCATE PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  truncated partition for rank 1 for relation "sales_ao" and its children
ALTER TABLE
-- Exchanging a Partition
CREATE TABLE sales_ao2 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_1" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_2" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_3" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_4" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_5" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_6" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_7" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_8" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_9" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_10" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_11" for table "sales_ao2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao2_1_prt_12" for table "sales_ao2"
CREATE TABLE
insert into sales_ao2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'usa');
INSERT 0 1000
insert into sales_ao2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'asia');
INSERT 0 1000
insert into sales_ao2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'europe');
INSERT 0 1000
ALTER TABLE sales_ao2 EXCHANGE PARTITION FOR ('2008-01-01') WITH 
TABLE jan08;
ALTER TABLE
-- Splitting a Partition
CREATE TABLE sales_ao3 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_1" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_2" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_3" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_4" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_5" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_6" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_7" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_8" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_9" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_10" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_11" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_12" for table "sales_ao3"
CREATE TABLE
ALTER TABLE sales_ao3 SPLIT PARTITION FOR ('2008-01-01') 
AT ('2008-01-16') 
INTO (PARTITION jan081to15, PARTITION jan0816to31);
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_jan081to15" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_jan0816to31" for table "sales_ao3"
ALTER TABLE
ALTER TABLE sales_ao3 ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_other" for table "sales_ao3"
ALTER TABLE
ALTER TABLE sales_ao3 SPLIT DEFAULT PARTITION 
START ('2009-01-01') INCLUSIVE 
END ('2009-02-01') EXCLUSIVE 
INTO (PARTITION jan09, PARTITION other);
psql:/path/sql_file:1: NOTICE:  exchanged partition "other" of relation "sales_ao3" with relation "pg_temp_78521"
psql:/path/sql_file:1: NOTICE:  dropped partition "other" for relation "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_jan09" for table "sales_ao3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_ao3_1_prt_other" for table "sales_ao3"
ALTER TABLE
-------------------------
---Hybrid partitions
-------------------------
CREATE TABLE sales_hybrid (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
SUBPARTITION BY LIST (region) 
SUBPARTITION TEMPLATE 
( SUBPARTITION usa VALUES ('usa'),  
  SUBPARTITION asia VALUES ('asia'),  
  SUBPARTITION europe VALUES ('europe') ) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_1" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_2" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_3" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_4" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_5" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_6" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_7" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_8" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_9" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_10" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_11" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_12" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_1_2_prt_usa" for table "sales_hybrid_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_1_2_prt_asia" for table "sales_hybrid_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_1_2_prt_europe" for table "sales_hybrid_1_prt_1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_2_2_prt_usa" for table "sales_hybrid_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_2_2_prt_asia" for table "sales_hybrid_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_2_2_prt_europe" for table "sales_hybrid_1_prt_2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_3_2_prt_usa" for table "sales_hybrid_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_3_2_prt_asia" for table "sales_hybrid_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_3_2_prt_europe" for table "sales_hybrid_1_prt_3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_4_2_prt_usa" for table "sales_hybrid_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_4_2_prt_asia" for table "sales_hybrid_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_4_2_prt_europe" for table "sales_hybrid_1_prt_4"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_5_2_prt_usa" for table "sales_hybrid_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_5_2_prt_asia" for table "sales_hybrid_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_5_2_prt_europe" for table "sales_hybrid_1_prt_5"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_6_2_prt_usa" for table "sales_hybrid_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_6_2_prt_asia" for table "sales_hybrid_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_6_2_prt_europe" for table "sales_hybrid_1_prt_6"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_7_2_prt_usa" for table "sales_hybrid_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_7_2_prt_asia" for table "sales_hybrid_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_7_2_prt_europe" for table "sales_hybrid_1_prt_7"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_8_2_prt_usa" for table "sales_hybrid_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_8_2_prt_asia" for table "sales_hybrid_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_8_2_prt_europe" for table "sales_hybrid_1_prt_8"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_9_2_prt_usa" for table "sales_hybrid_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_9_2_prt_asia" for table "sales_hybrid_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_9_2_prt_europe" for table "sales_hybrid_1_prt_9"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_10_2_prt_usa" for table "sales_hybrid_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_10_2_prt_asia" for table "sales_hybrid_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_10_2_prt_europe" for table "sales_hybrid_1_prt_10"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_11_2_prt_usa" for table "sales_hybrid_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_11_2_prt_asia" for table "sales_hybrid_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_11_2_prt_europe" for table "sales_hybrid_1_prt_11"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_12_2_prt_usa" for table "sales_hybrid_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_12_2_prt_asia" for table "sales_hybrid_1_prt_12"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_12_2_prt_europe" for table "sales_hybrid_1_prt_12"
CREATE TABLE
insert into sales_hybrid values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'usa');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'asia');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'europe');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1001,2000),'2008-06-01',generate_series(1,1000), 'usa');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1001,2000),'2008-06-01',generate_series(1,1000), 'asia');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1001,2000),'2008-06-01',generate_series(1,1000), 'europe');
INSERT 0 1000
-- Partitioning an Existing Table
CREATE TABLE sales_hybrid1 (LIKE sales_hybrid) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month'));
psql:/path/sql_file:1: NOTICE:  Table doesn't have 'distributed by' clause, defaulting to distribution columns from LIKE table
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_1" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_2" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_3" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_4" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_5" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_6" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_7" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_8" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_9" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_10" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_11" for table "sales_hybrid1"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid1_1_prt_12" for table "sales_hybrid1"
CREATE TABLE
INSERT INTO sales_hybrid1 SELECT * FROM sales_hybrid; 
INSERT 0 6000
-- Verifying Your Partition Strategy 
EXPLAIN SELECT * FROM sales_hybrid WHERE date='01-07-08' AND 
region='usa';
                                                   QUERY PLAN                                                   
----------------------------------------------------------------------------------------------------------------
 Gather Motion 2:1  (slice1; segments: 2)  (cost=0.00..6.91 rows=1 width=53)
   ->  Append  (cost=0.00..6.91 rows=1 width=53)
         ->  Append-only Scan on sales_hybrid_1_prt_1_2_prt_usa sales_hybrid  (cost=0.00..6.91 rows=1 width=53)
               Filter: date = '2008-01-07'::date AND region = 'usa'::text
(4 rows)

--Viewing Your Partition Design 
SELECT partitionboundary, partitiontablename, partitionname, 
partitionlevel, partitionrank FROM pg_partitions WHERE 
tablename='sales_hybrid'; 
                                                   partitionboundary                                                   |         partitiontablename         | partitionname | partitionlevel | partitionrank 
-----------------------------------------------------------------------------------------------------------------------+------------------------------------+---------------+----------------+---------------
 START ('2008-01-01'::date) END ('2008-02-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_1               |               |              0 |             1
 START ('2008-02-01'::date) END ('2008-03-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_2               |               |              0 |             2
 START ('2008-03-01'::date) END ('2008-04-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_3               |               |              0 |             3
 START ('2008-04-01'::date) END ('2008-05-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_4               |               |              0 |             4
 START ('2008-05-01'::date) END ('2008-06-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_5               |               |              0 |             5
 START ('2008-06-01'::date) END ('2008-07-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_6               |               |              0 |             6
 START ('2008-07-01'::date) END ('2008-08-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_7               |               |              0 |             7
 START ('2008-08-01'::date) END ('2008-09-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_8               |               |              0 |             8
 START ('2008-09-01'::date) END ('2008-10-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_9               |               |              0 |             9
 START ('2008-10-01'::date) END ('2008-11-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_10              |               |              0 |            10
 START ('2008-11-01'::date) END ('2008-12-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_11              |               |              0 |            11
 START ('2008-12-01'::date) END ('2009-01-01'::date) EVERY ('1 mon'::interval) WITH (appendonly=true, compresslevel=5) | sales_hybrid_1_prt_12              |               |              0 |            12
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_1_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_1_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_1_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_10_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_10_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_10_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_11_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_11_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_11_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_12_2_prt_usa    | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_12_2_prt_asia   | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_12_2_prt_europe | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_2_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_2_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_2_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_3_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_3_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_3_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_4_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_4_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_4_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_5_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_5_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_5_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_6_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_6_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_6_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_7_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_7_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_7_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_8_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_8_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_8_2_prt_europe  | europe        |              1 |              
 SUBPARTITION usa VALUES('usa') WITH (appendonly=true, compresslevel=5)                                                | sales_hybrid_1_prt_9_2_prt_usa     | usa           |              1 |              
 SUBPARTITION asia VALUES('asia') WITH (appendonly=true, compresslevel=5)                                              | sales_hybrid_1_prt_9_2_prt_asia    | asia          |              1 |              
 SUBPARTITION europe VALUES('europe') WITH (appendonly=true, compresslevel=5)                                          | sales_hybrid_1_prt_9_2_prt_europe  | europe        |              1 |              
(48 rows)

-- Adding a New Partition 
ALTER TABLE sales_hybrid ALTER PARTITION FOR (RANK(12)) 
      ADD PARTITION africa VALUES ('africa');
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_12_2_prt_africa" for table "sales_hybrid_1_prt_12"
ALTER TABLE
-- Adding a Default Partition
ALTER TABLE sales_hybrid ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_other" for table "sales_hybrid"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_other_2_prt_usa" for table "sales_hybrid_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_other_2_prt_asia" for table "sales_hybrid_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_other_2_prt_europe" for table "sales_hybrid_1_prt_other"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid_1_prt_other_2_prt_africa" for table "sales_hybrid_1_prt_other"
ALTER TABLE
insert into sales_hybrid values(generate_series(1,1000),'2009-01-01',generate_series(1,1000), 'usa');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1,1000),'2009-01-01',generate_series(1,1000), 'asia');
INSERT 0 1000
insert into sales_hybrid values(generate_series(1,1000),'2009-01-01',generate_series(1,1000), 'europe');
INSERT 0 1000
-- Renaming a Partition
--ALTER TABLE sales_hybrid RENAME PARTITION FOR ('2008-01-01') TO jan08;
ALTER TABLE sales_hybrid RENAME PARTITION FOR (RANK(1)) TO jan08;
ALTER TABLE
-- Dropping a Partition
ALTER TABLE sales_hybrid DROP PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  dropped partition "jan08" for relation "sales_hybrid" and its children
ALTER TABLE
-- Truncating a Partition
ALTER TABLE sales_hybrid TRUNCATE PARTITION FOR (RANK(1));
psql:/path/sql_file:1: NOTICE:  truncated partition for rank 1 for relation "sales_hybrid" and its children
ALTER TABLE
-- Exchanging a Partition
CREATE TABLE sales_hybrid2 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_1" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_2" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_3" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_4" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_5" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_6" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_7" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_8" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_9" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_10" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_11" for table "sales_hybrid2"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid2_1_prt_12" for table "sales_hybrid2"
CREATE TABLE
insert into sales_hybrid2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'usa');
INSERT 0 1000
insert into sales_hybrid2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'asia');
INSERT 0 1000
insert into sales_hybrid2 values(generate_series(1,1000),'2008-01-01',generate_series(1,1000), 'europe');
INSERT 0 1000
ALTER TABLE sales_hybrid2 EXCHANGE PARTITION FOR ('2008-01-01') WITH 
TABLE jan08;
ALTER TABLE
-- Splitting a Partition
CREATE TABLE sales_hybrid3 (trans_id int, date date, amount 
decimal(9,2), region text) 
DISTRIBUTED BY (trans_id) 
PARTITION BY RANGE (date) 
( START (date '2008-01-01') INCLUSIVE 
   END (date '2009-01-01') EXCLUSIVE 
   EVERY (INTERVAL '1 month')
   WITH (appendonly=true, compresslevel=5)); 
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_1" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_2" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_3" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_4" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_5" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_6" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_7" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_8" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_9" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_10" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_11" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_12" for table "sales_hybrid3"
CREATE TABLE
ALTER TABLE sales_hybrid3 SPLIT PARTITION FOR ('2008-01-01') 
AT ('2008-01-16') 
INTO (PARTITION jan081to15, PARTITION jan0816to31);
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_jan081to15" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_jan0816to31" for table "sales_hybrid3"
ALTER TABLE
ALTER TABLE sales_hybrid3 ADD DEFAULT PARTITION other;
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_other" for table "sales_hybrid3"
ALTER TABLE
ALTER TABLE sales_hybrid3 SPLIT DEFAULT PARTITION 
START ('2009-01-01') INCLUSIVE 
END ('2009-02-01') EXCLUSIVE 
INTO (PARTITION jan09, PARTITION other);
psql:/path/sql_file:1: NOTICE:  exchanged partition "other" of relation "sales_hybrid3" with relation "pg_temp_83152"
psql:/path/sql_file:1: NOTICE:  dropped partition "other" for relation "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_jan09" for table "sales_hybrid3"
psql:/path/sql_file:1: NOTICE:  CREATE TABLE will create partition "sales_hybrid3_1_prt_other" for table "sales_hybrid3"
ALTER TABLE
